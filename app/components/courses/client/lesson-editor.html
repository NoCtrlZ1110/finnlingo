<template name="lesson-editor">
    <div class="content wide">
        <div class="lesson-editor">
            <top-bar v-bind:back-link="'/courses/' + $route.params.id" back-link-text="Back to course tree" />
            <div class="words-column">
                <h4>Words</h4>
                <list-editor 
                    v-bind:items="words.filter(w => w.lessonId == this.$route.params.lessonid)"
                    can-edit="text"
                    can-remove="true"
                    new-item-text="Add new word"
                    v-bind:item-class="getWordClass"
                    v-on:add="WordsApi.addWord('New word',$route.params.lessonid)"
                    v-on:select="selectWord"
                    v-on:edit="WordsApi.updateWord"
                    v-on:remove="WordsApi.removeWord">
                </list-editor>
            </div>
            <div class="editor-column" v-if="selectedWord" v-bind:class="{ hidden: !!selectedSentence }">
                <div class="top-bar">Word: {{selectedWord.text}}</div>
                <h4>Translations</h4>
                <list-editor 
                    v-bind:items="selectedWord.translations"
                    can-edit="text"
                    can-remove="true"
                    new-item-text="Add new translation"
                    v-on:add="selectedWord.translations.push({ text: 'New translation' }); WordsApi.updateWord(selectedWord)"
                    v-on:edit="WordsApi.updateWord(selectedWord)"
                    v-on:remove="removeTranslation">
                </list-editor>
                <h4>Inflection</h4>
                <list-editor 
                    v-bind:items="selectedWord.inflections"
                    can-edit="text"
                    can-remove="true"
                    new-item-text="Add new form of word"
                    v-on:add="selectedWord.inflections.push({ text: '', remarks: '' }); WordsApi.updateWord(selectedWord)"
                    v-on:edit="WordsApi.updateWord(selectedWord)"
                    v-on:remove="removeTranslation">
                      <template scope="props">
                          <input type="text" v-model="props.item.text" class="text" placeholder="Word form" v-on:blur="WordsApi.updateWord(selectedWord)" />
                          <input type="text" v-model="props.item.remarks" class="remarks" placeholder="Translation" v-on:blur="WordsApi.updateWord(selectedWord)" />
                      </template>
                </list-editor>
                <h4>Picture</h4>
                <select v-model="selectedWord.picture" v-on:click="WordsApi.updateWord(selectedWord)">
                    <option v-bind:value="null">(none)</option>
                    <option v-for="option in ['man','boy','woman','girl','apple']" v-bind:value="'/' + option + '.svg'">
                        {{ option }}
                    </option>
                </select>
                <img class="word-picture" v-if="selectedWord.picture" v-bind:src="selectedWord.picture" />
                <h4>Remarks</h4>
                <textarea v-model="selectedWord.remarks" v-on:blur="WordsApi.updateWord(selectedWord)"></textarea>
            </div>
            <div class="sentences-column">
                <h4>Sentences</h4>
                <p class="description">
                    Sentences will appear in the lesson in exactly same order as defined below.
                </p>
                <list-editor 
                    v-bind:items="sentences.filter(w => w.lessonId == this.$route.params.lessonid)"
                    can-edit="text"
                    can-remove="true"
                    new-item-text="Add new sentence"
                    v-bind:item-class="getSentenceClass"
                    v-on:add="SentencesApi.addSentence('New sentence',$route.params.lessonid)"
                    v-on:select="selectSentence"
                    v-on:edit="SentencesApi.updateSentence"
                    v-on:remove="SentencesApi.removeSentence">
                    <template slot="buttons" scope="props">
                        <a href="javascript:void(0);" v-on:click="changeSentenceOrder(props.item,-1)"><i class="fa fa-chevron-up"></i></a>
                        <a href="javascript:void(0);" v-on:click="changeSentenceOrder(props.item,1)"><i class="fa fa-chevron-down"></i></a>
                    </template>
                </list-editor>
            </div>
            <div class="editor-column" v-if="selectedSentence">
                <div class="top-bar">Sentence: {{selectedSentence.text}}</div>
                <h4>Test type</h4>
                <input id="test-type-default" type="radio" 
                    v-model="selectedSentence.testType" 
                    v-bind:value="SentenceTestType.Default"
                    v-on:click="SentencesApi.updateSentence(selectedSentence)" />
                <label for="test-type-default">Default</label>
                <input id="test-type-wordpictures" type="radio" 
                    v-model="selectedSentence.testType"
                    v-bind:value="SentenceTestType.WordPictures"
                    v-on:click="SentencesApi.updateSentence(selectedSentence)" />
                <label for="test-type-wordpictures">Word pictures</label>
                <h4>Translations</h4>
                <list-editor 
                    v-bind:items="selectedSentence.translations"
                    can-edit="text"
                    can-remove="true"
                    new-item-text="Add new translation"
                    v-on:add="selectedSentence.translations.push({ text: 'New translation' }); SentencesApi.updateSentence(selectedSentence)"
                    v-on:edit="SentencesApi.updateSentence(selectedSentence)"
                    v-on:remove="removeTranslation">
                </list-editor>
            </div>
        </div>
    </div>
</template>